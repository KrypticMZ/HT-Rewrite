package me.htrewrite.client.module.modules.exploit;

import me.htrewrite.client.module.Module;
import me.htrewrite.client.module.ModuleType;
import me.htrewrite.exeterimports.mcapi.settings.IntegerSetting;
import me.htrewrite.exeterimports.mcapi.settings.ToggleableSetting;
import me.zero.alpine.fork.listener.EventHandler;
import me.zero.alpine.fork.listener.Listener;
import net.minecraft.entity.EntityLivingBase;
import net.minecraft.network.play.client.CPacketEntityAction;
import net.minecraftforge.event.entity.player.AttackEntityEvent;

public class KnockbackPlusModule extends Module {
    private final IntegerSetting hurtTime = new IntegerSetting("hurtTime", null, 10, 0, 10);
    private final ToggleableSetting disable = new ToggleableSetting("AutoDisable", null, false);

    public KnockbackPlusModule() {
        super("Knockback+", "Applies knockback 2 when you attack someone with an item.", ModuleType.Exploits, 0);
        addOption(hurtTime);
        addOption(disable);
        endOption();
    }

    @EventHandler
    private Listener<AttackEntityEvent> onAttackEntity = new Listener<>(event -> {
        if (event.getTarget() instanceof EntityLivingBase) {
            if (((EntityLivingBase) event.getTarget()).hurtTime > hurtTime.getValue())
                return;

            if (mc.player.isSprinting())
                mc.player.connection.sendPacket(new CPacketEntityAction(mc.player, CPacketEntityAction.Action.STOP_SPRINTING));

            mc.player.connection.sendPacket(new CPacketEntityAction(mc.player, CPacketEntityAction.Action.START_SPRINTING));
            mc.player.connection.sendPacket(new CPacketEntityAction(mc.player, CPacketEntityAction.Action.STOP_SPRINTING));
            mc.player.connection.sendPacket(new CPacketEntityAction(mc.player, CPacketEntityAction.Action.START_SPRINTING));
            mc.player.setSprinting(true);
            mc.player.serverSprintState = true;

            if (disable.isEnabled())
                toggle();
        }
    });
}